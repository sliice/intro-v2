{"ast":null,"code":"var _jsxFileName = \"/Users/alisakrylova/Intro2/client/src/components/ProfileViewForStudents.js\";\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { useParams, useHistory, NavLink } from \"react-router-dom\";\nimport { AuthContext } from \"./Context/AuthContext\";\nimport { useHttp } from \"../Hooks/Http.hook\";\nimport { emojis, emojiToString } from \"./Helpers/Emoji\";\nimport notify from \"./Helpers/Notify\";\nimport './Appearence/Css/Profile.css';\nimport './Appearence/Css/index.css';\nimport SearchIcon from \"./Appearence/Images/SearchIcon\";\nimport { ReactComponent as SortIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!./Appearence/Images/SortIcon.svg\";\nexport const ProfileViewForStudents = () => {\n  let login = useParams().id;\n  const history = useHistory();\n  const {\n    request\n  } = useHttp();\n  const {\n    token,\n    username\n  } = useContext(AuthContext);\n  const [results, setResults] = useState([]);\n  const [shown, setShown] = useState([]);\n  const [isSearching, activateSearching] = useState('none');\n  const [isChoosingEmoji, activateChoosingEmoji] = useState(false);\n  const [search, setSearch] = useState('');\n  const [notFound, setNotFound] = useState();\n  const [sorted, setSorted] = useState(false);\n  const [resultsFetched, setResultsFetched] = useState(false);\n  const [userDataFetched, setUserDataFetched] = useState(false);\n  if (login !== username) history.push('/');\n  const [userData, setUserData] = useState({\n    name: '',\n    surname: '',\n    login: '',\n    type: '',\n    pic: '',\n    birthdate: ''\n  });\n  const [userEditedData, setUserEditedData] = useState({\n    pic: ''\n  });\n\n  const showAll = () => {\n    let shownSize = [];\n\n    for (let i = 0; i < results.length; i++) {\n      shownSize.push(i);\n    }\n\n    setShown([...shownSize]);\n  };\n\n  const fetchUserData = useCallback(async () => {\n    try {\n      const fetched = await request(`/api/users/get/${username}`, 'GET', null, {\n        Authorization: `Bearer ${token}`\n      });\n      setUserData(fetched);\n      setUserEditedData(fetched);\n      setUserDataFetched(true);\n      if (fetched) document.title = fetched.name + ' ' + fetched.surname;\n    } catch (e) {}\n  }, [token, username]);\n  const fetchResults = useCallback(async () => {\n    try {\n      const fetched = await request(`/api/results/${username}`, 'GET', null, {\n        Authorization: `Bearer ${token}`\n      });\n      fetched.sort((a, b) => a.date < b.date ? 1 : -1);\n      setResults(fetched);\n      setResultsFetched(true);\n    } catch (e) {}\n  }, [token, username]);\n\n  const handleSearchActivating = e => {\n    e.preventDefault();\n\n    switch (isSearching) {\n      case 'active':\n        activateSearching('inactive');\n        break;\n\n      case 'none':\n      case 'inactive':\n        activateSearching('active');\n        document.getElementById('search').focus();\n        break;\n    }\n  };\n\n  const doSearch = e => {\n    e.preventDefault();\n\n    try {\n      let searchFilter = e.target.value.toString().toLowerCase();\n      setSearch(searchFilter);\n      setNotFound(false);\n\n      if (searchFilter != '') {\n        let resultsArray = [];\n        results.map(result => {\n          let res = '';\n          result.scales.map(r => {\n            res += r.toString();\n          });\n          resultsArray.push((result.test + res).toString().toLowerCase());\n        });\n        let indexes = [];\n        resultsArray.map((result, i) => {\n          if (resultsArray[i].toString().includes(searchFilter)) indexes.push(i);\n        });\n\n        if (indexes.length != 0) {\n          setNotFound(false);\n        } else setNotFound(true);\n      }\n    } catch (e) {}\n  };\n\n  const doSort = e => {\n    e.preventDefault();\n\n    try {\n      switch (sorted) {\n        case true:\n          document.getElementById('sortIcon').style = 'transform: rotate(360deg);';\n          document.getElementById('resultsCollection').style = 'flex-direction: column;';\n          setSorted(false);\n          break;\n\n        case false:\n          document.getElementById('sortIcon').style = 'transform: rotate(180deg);';\n          document.getElementById('resultsCollection').style = 'flex-direction: column-reverse;';\n          setSorted(true);\n          break;\n      }\n    } catch (e) {}\n  };\n\n  const handleChooseEmojiActivating = e => {\n    e.preventDefault();\n    activateChoosingEmoji(!isChoosingEmoji);\n  };\n\n  const saveEditedData = async e => {\n    e.persist();\n\n    try {\n      const data = await request('/api/users/edit', 'POST', { ...userData,\n        oldLogin: userData.login,\n        pic: emojis[e.target.id.slice(1)]\n      });\n      setUserData({ ...userData,\n        pic: emojis[e.target.id.slice(1)]\n      });\n      if (data.message === 'User\\'ve edited') notify('Новый эмоджи профиля установлен');\n    } catch (e) {}\n  };\n\n  useEffect(() => {\n    document.body.style = 'transition-duration: .7s; transition-timing-function: ease-in-out; background: white;';\n    fetchUserData();\n    fetchResults();\n    if (shown.length == 0) showAll();\n  }, [username, resultsFetched, userDataFetched]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profileContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profileEditingPic\",\n    onClick: e => handleChooseEmojiActivating(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 17\n    }\n  }, \" \", emojiToString(userData.pic), \" \"), isChoosingEmoji && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"emojiContainerOnProfile\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profileEditingPic\",\n    onClick: e => handleChooseEmojiActivating(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 25\n    }\n  }, \" \", emojiToString(userData.pic), \" \"), emojis.map((emoji, i) => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"addingStudentEmoji\",\n      onClick: e => saveEditedData(e),\n      key: i,\n      id: 'e' + i,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 37\n      }\n    }, emojiToString(emoji));\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profileHeader\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    id: \"fio\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 21\n    }\n  }, userData.name, \" \", userData.surname), /*#__PURE__*/React.createElement(\"h2\", {\n    id: \"loginOnProfile\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 21\n    }\n  }, userData.login), userData.type === 's' && /*#__PURE__*/React.createElement(\"h3\", {\n    id: \"type\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 21\n    }\n  }, \"\\u0423\\u0447\\u0435\\u043D\\u0438\\u043A\"))), results.length != 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"searchAndSort\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    id: \"search\",\n    className: isSearching === 'active' && 'searchAppearing' || isSearching === 'inactive' && 'searchDisappearing' || isSearching === 'none' && 'invisible',\n    placeholder: \"\\u041F\\u043E\\u0438\\u0441\\u043A \\u043F\\u043E \\u0440\\u0435\\u0437\\u0443\\u043B\\u044C\\u0442\\u0430\\u0442\\u0430\\u043C\",\n    onChange: e => doSearch(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(SearchIcon, {\n    handleSearchActivating: handleSearchActivating,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(SortIcon, {\n    onClick: e => doSort(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"resultsCollection\",\n    className: \"results\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 13\n    }\n  }, notFound && /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"notFound\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 33\n    }\n  }, \"\\u041D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\") || !notFound && results.map((result, index) => {\n    if ((result.test + result.scales).toLowerCase().includes(search)) return /*#__PURE__*/React.createElement(NavLink, {\n      to: `/tests/${result.link}/${username}`,\n      key: index,\n      className: \"resultItem soft_appearing\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"resultTestName\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 33\n      }\n    }, result.test), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"shortResult\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 33\n      }\n    }, result.scales.map((res, i) => {\n      return /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 49\n        }\n      }, res);\n    })));\n  }), !notFound && !results[0] && /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"notFound\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 21\n    }\n  }, \"\\u0420\\u0435\\u0437\\u0443\\u043B\\u044C\\u0442\\u0430\\u0442\\u043E\\u0432 \\u043F\\u043E\\u043A\\u0430 \\u043D\\u0435\\u0442\")));\n};\nexport default ProfileViewForStudents;","map":{"version":3,"sources":["/Users/alisakrylova/Intro2/client/src/components/ProfileViewForStudents.js"],"names":["React","useCallback","useContext","useEffect","useState","useParams","useHistory","NavLink","AuthContext","useHttp","emojis","emojiToString","notify","SearchIcon","ProfileViewForStudents","login","id","history","request","token","username","results","setResults","shown","setShown","isSearching","activateSearching","isChoosingEmoji","activateChoosingEmoji","search","setSearch","notFound","setNotFound","sorted","setSorted","resultsFetched","setResultsFetched","userDataFetched","setUserDataFetched","push","userData","setUserData","name","surname","type","pic","birthdate","userEditedData","setUserEditedData","showAll","shownSize","i","length","fetchUserData","fetched","Authorization","document","title","e","fetchResults","sort","a","b","date","handleSearchActivating","preventDefault","getElementById","focus","doSearch","searchFilter","target","value","toString","toLowerCase","resultsArray","map","result","res","scales","r","test","indexes","includes","doSort","style","handleChooseEmojiActivating","saveEditedData","persist","data","oldLogin","slice","message","body","emoji","index","link"],"mappings":"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","sourcesContent":["import React, {useCallback, useContext, useEffect, useState} from 'react'\nimport {useParams, useHistory, NavLink} from \"react-router-dom\";\n\nimport {AuthContext} from \"./Context/AuthContext\"\nimport {useHttp} from \"../Hooks/Http.hook\"\nimport {emojis, emojiToString} from \"./Helpers/Emoji\";\nimport notify from \"./Helpers/Notify\";\n\nimport './Appearence/Css/Profile.css'\nimport './Appearence/Css/index.css'\n\nimport SearchIcon from \"./Appearence/Images/SearchIcon\";\nimport {ReactComponent as SortIcon} from './Appearence/Images/SortIcon.svg'\n\nexport const ProfileViewForStudents = () => {\n\n    let login = useParams().id\n\n    const history = useHistory()\n\n    const {request} = useHttp();\n    const {token, username} = useContext(AuthContext)\n    const [results, setResults] = useState([])\n    const [shown, setShown] = useState([])\n    const [isSearching, activateSearching] = useState('none')\n    const [isChoosingEmoji, activateChoosingEmoji] = useState(false)\n    const [search, setSearch] = useState('')\n    const [notFound, setNotFound] = useState()\n    const [sorted, setSorted] = useState(false)\n    const [resultsFetched, setResultsFetched] = useState(false)\n    const [userDataFetched, setUserDataFetched] = useState(false)\n\n    if (login !== username)\n        history.push('/')\n\n    const [userData, setUserData] = useState({\n        name: '',\n        surname: '',\n        login: '',\n        type: '',\n        pic: '',\n        birthdate: ''\n    })\n    const [userEditedData, setUserEditedData] = useState({\n        pic: ''\n    })\n\n    const showAll = () => {\n        let shownSize = []\n        for (let i = 0; i < results.length; i++){\n            shownSize.push(i)\n        }\n        setShown([...shownSize])\n    }\n\n\n    const fetchUserData = useCallback(async () => {\n        try {\n            const fetched = await request(`/api/users/get/${username}`, 'GET', null, {\n                Authorization: `Bearer ${token}`\n            })\n            setUserData(fetched)\n            setUserEditedData(fetched)\n            setUserDataFetched(true)\n            if (fetched) document.title = fetched.name + ' ' + fetched.surname\n        }\n        catch (e) {}\n    }, [token, username])\n\n    const fetchResults = useCallback(async () => {\n        try {\n            const fetched = await request(`/api/results/${username}`, 'GET', null, {\n                Authorization: `Bearer ${token}`\n            })\n\n            fetched.sort((a, b) => a.date < b.date ? 1 : -1)\n            setResults(fetched)\n            setResultsFetched(true)\n        }\n        catch (e) {}\n    }, [token, username])\n\n\n    const handleSearchActivating = e => {\n        e.preventDefault()\n        switch (isSearching){\n            case 'active':\n                activateSearching('inactive');\n                break\n            case 'none':\n            case 'inactive':\n                activateSearching('active');\n                document.getElementById('search').focus()\n                break\n        }\n    }\n\n    const doSearch = e => {\n        e.preventDefault()\n        try {\n            let searchFilter = e.target.value.toString().toLowerCase()\n            setSearch(searchFilter)\n            setNotFound(false)\n            if (searchFilter != '') {\n                let resultsArray = []\n                results.map(result => {\n                    let res = ''\n                    result.scales.map(r => {\n                        res += r.toString()\n                    })\n                    resultsArray.push((result.test + res).toString().toLowerCase())\n                })\n\n                let indexes = []\n                resultsArray.map((result, i) => {\n                    if (resultsArray[i].toString().includes(searchFilter))\n                        indexes.push(i)\n                })\n\n                if (indexes.length != 0) {\n                    setNotFound(false)\n                }\n                else setNotFound(true)\n            }\n        }\n        catch (e) {}\n    }\n\n    const doSort = e => {\n        e.preventDefault()\n        try {\n            switch (sorted) {\n                case true:\n                    document.getElementById('sortIcon').style = 'transform: rotate(360deg);'\n                    document.getElementById('resultsCollection').style = 'flex-direction: column;'\n                    setSorted(false);\n                    break;\n                case false:\n                    document.getElementById('sortIcon').style = 'transform: rotate(180deg);'\n                    document.getElementById('resultsCollection').style = 'flex-direction: column-reverse;'\n                    setSorted(true);\n                    break;\n            }\n        }\n        catch (e) {}\n    }\n\n    const handleChooseEmojiActivating = e => {\n        e.preventDefault()\n        activateChoosingEmoji(!isChoosingEmoji)\n    }\n\n    const saveEditedData = async(e) => {\n        e.persist()\n        try {\n            const data = await request('/api/users/edit', 'POST', {...userData, oldLogin: userData.login, pic: emojis[e.target.id.slice(1)]})\n            setUserData({...userData, pic: emojis[e.target.id.slice(1)]})\n            if (data.message === 'User\\'ve edited') notify('Новый эмоджи профиля установлен')\n        }\n        catch (e) {}\n    }\n\n\n    useEffect(() => {\n        document.body.style = 'transition-duration: .7s; transition-timing-function: ease-in-out; background: white;'\n\n        fetchUserData()\n        fetchResults()\n\n        if (shown.length == 0) showAll()\n\n    }, [username, resultsFetched, userDataFetched])\n\n\n    return (\n        <div>\n            <div className = 'profileContainer'>\n\n                <div className = 'profileEditingPic' onClick = {e => handleChooseEmojiActivating(e)}> {emojiToString(userData.pic)} </div>\n                {isChoosingEmoji &&\n                    <div className = 'emojiContainerOnProfile'>\n                        <div className = 'profileEditingPic' onClick = {e => handleChooseEmojiActivating(e)}> {emojiToString(userData.pic)} </div>\n                        {\n                            emojis.map((emoji, i) => {\n                                return (\n                                    <div className = 'addingStudentEmoji' onClick = {e => saveEditedData(e)} key = {i} id = {'e' + i}>\n                                        {emojiToString(emoji)}\n                                    </div>\n                                )\n                            })\n                        }\n                    </div>\n                }\n\n                <div className = 'profileHeader'>\n\n                    <h1 id = 'fio'>{userData.name} {userData.surname}</h1>\n                    <h2 id = 'loginOnProfile'>{userData.login}</h2>\n\n                    {userData.type === 's' &&\n                    <h3 id = 'type'>Ученик</h3>}\n\n                </div>\n            </div>\n\n            {results.length != 0 &&\n            <div className = 'searchAndSort'>\n                <input type = 'text' id = 'search'\n                       className = {  isSearching === 'active' && 'searchAppearing' ||\n                       isSearching === 'inactive' && 'searchDisappearing' ||\n                       isSearching === 'none' && 'invisible'}\n                       placeholder = 'Поиск по результатам' onChange = { e => doSearch(e) }/>\n\n                <SearchIcon handleSearchActivating = {handleSearchActivating}/>\n                <SortIcon onClick = { e => doSort(e) } />\n\n\n\n            </div>\n            }\n\n            <div id = 'resultsCollection' className = 'results'>\n                {\n                    notFound && <h1 className = 'notFound'>Ничего не найдено</h1> ||\n                    !notFound &&\n                    results.map((result, index) => {\n                        if ((result.test + result.scales).toLowerCase().includes(search))\n                        return (\n                            <NavLink to={`/tests/${result.link}/${username}`} key={index} className='resultItem soft_appearing'>\n                                <p className='resultTestName'>{result.test}</p>\n                                <div className='shortResult'>\n                                    {\n                                        result.scales.map((res, i) => {\n                                            return (\n                                                <p>{res}</p>\n                                            )\n                                        })\n                                    }\n                                </div>\n                            </NavLink>\n                        )\n                    })\n                }\n                {\n                    !notFound && !results[0] &&\n                    <h1 className = 'notFound'>Результатов пока нет</h1>\n                }\n            </div>\n\n        </div>\n    )\n\n\n}\n\nexport default ProfileViewForStudents"]},"metadata":{},"sourceType":"module"}